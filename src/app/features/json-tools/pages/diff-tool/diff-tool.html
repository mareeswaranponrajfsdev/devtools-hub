<div class="diff-tool-container">
  
  <!-- Header Section -->
  <div class="page-header">
    <h1 class="page-title">
      <i class="fa-solid fa-code-compare title-icon"></i>
      JSON Diff & Compare
    </h1>
  </div>

  <!-- Compact Action & Export Bar -->
  <div class="compact-control-bar">
    <!-- Action Buttons -->
    <div class="action-buttons">
      <button 
        type="button"
        class="btn-action btn-primary btn-primary-action"
        (click)="compareLists()"
        [disabled]="isProcessing()">
        <i class="fa-solid fa-code-compare"></i>
        <span>{{ isProcessing() ? 'Comparing...' : 'Compare' }}</span>
      </button>
      <button 
        type="button"
        class="btn-action btn-secondary-action"
        (click)="loadSample()">
        <i class="fa-solid fa-file-code"></i>
        <span>Sample</span>
      </button>
      <button 
        type="button"
        class="btn-action btn-danger-action"
        (click)="clear()">
        <i class="fa-solid fa-trash-can"></i>
        <span>Clear</span>
      </button>
    </div>

    <!-- Export Buttons -->
    <div *ngIf="differences().length > 0" class="export-buttons-inline">
      <span class="export-label-inline">
        <i class="fa-solid fa-download"></i>
        Export:
      </span>
      <button 
        type="button"
        class="btn-export-inline"
        (click)="exportDifferencesJSON()">
        <i class="fa-solid fa-file-code"></i>
        JSON
      </button>
      <button 
        type="button"
        class="btn-export-inline"
        (click)="exportDifferencesCSV()">
        <i class="fa-solid fa-file-csv"></i>
        CSV
      </button>
      <button 
        type="button"
        class="btn-export-inline"
        (click)="exportDifferencesTXT()">
        <i class="fa-solid fa-file-lines"></i>
        TXT
      </button>
    </div>
  </div>
  
  <!-- Copy Feedback Toast -->
  <div *ngIf="copyFeedback()" class="copy-toast">
    <div class="copy-toast-content">
      <i class="fa-solid fa-circle-check"></i>
      <span>{{ copyFeedback() }}</span>
    </div>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error()" class="alert-error">
    <i class="fa-solid fa-circle-exclamation"></i>
    <span>{{ error() }}</span>
  </div>

  <!-- Compact Summary -->
  <div *ngIf="differences().length > 0" class="compact-summary">
    <div class="summary-item summary-added">
      <i class="fa-solid fa-plus-circle"></i>
      <span class="summary-value">{{ getDiffCount('added') }}</span>
      <span class="summary-text">Added</span>
    </div>
    <div class="summary-item summary-removed">
      <i class="fa-solid fa-minus-circle"></i>
      <span class="summary-value">{{ getDiffCount('removed') }}</span>
      <span class="summary-text">Removed</span>
    </div>
    <div class="summary-item summary-modified">
      <i class="fa-solid fa-pen"></i>
      <span class="summary-value">{{ getDiffCount('modified') }}</span>
      <span class="summary-text">Modified</span>
    </div>
    <div class="summary-scroll-hint">
      <i class="fa-solid fa-arrow-down"></i>
      <span>Scroll for details</span>
    </div>
  </div>

  <!-- Monaco Editor Section -->
  <div class="editor-section">
    <div class="editor-card">
      <!-- Editor Header with Copy Buttons -->
      <div class="editor-header">
        <div class="editor-side editor-side-left">
          <div class="editor-label">
            <i class="fa-solid fa-file-code"></i>
            <span>JSON 1 (Original)</span>
          </div>
          <button 
            type="button"
            class="btn-copy-editor"
            (click)="copyJSON1()"
            title="Copy JSON 1 to clipboard">
            <i class="fa-solid fa-copy"></i>
            <span>Copy</span>
          </button>
        </div>
        <div class="editor-divider"></div>
        <div class="editor-side editor-side-right">
          <div class="editor-label">
            <i class="fa-solid fa-file-code"></i>
            <span>JSON 2 (Modified)</span>
          </div>
          <button 
            type="button"
            class="btn-copy-editor"
            (click)="copyJSON2()"
            title="Copy JSON 2 to clipboard">
            <i class="fa-solid fa-copy"></i>
            <span>Copy</span>
          </button>
        </div>
      </div>
      
      <!-- Monaco Diff Editor -->
      <div #diffEditorContainer class="monaco-editor-wrapper"></div>
      
      <!-- Editor Footer Info -->
      <div class="editor-footer">
        <div class="footer-info">
          <i class="fa-solid fa-circle-info"></i>
          <span>Scroll synchronized • Code folding enabled • Click ▼ to collapse/expand nested objects</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Differences Table -->
  <div *ngIf="differences().length > 0" class="differences-section">
    <div class="differences-header">
      <h3 class="differences-title">
        <i class="fa-solid fa-list-check"></i>
        Detailed Differences
        <span class="differences-count">{{ differences().length }}</span>
      </h3>
      <button 
        type="button"
        class="btn-copy-diffs"
        (click)="copyDifferences()">
        <i class="fa-solid fa-copy"></i>
        <span>Copy All</span>
      </button>
    </div>
    <div class="table-wrapper">
      <table class="diff-table">
        <thead>
          <tr>
            <th class="th-path">Path</th>
            <th class="th-status">Status</th>
            <th class="th-value">Original Value</th>
            <th class="th-value">New Value</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let diff of differences()" [class]="'row-' + diff.type">
            <td class="td-path">
              <code class="path-code">{{ diff.path }}</code>
            </td>
            <td class="td-status">
              <span class="status-badge" [class]="'badge-' + diff.type">
                <i class="fa-solid" 
                   [class.fa-plus]="diff.type === 'added'"
                   [class.fa-minus]="diff.type === 'removed'"
                   [class.fa-pen]="diff.type === 'modified'"
                   [class.fa-check]="diff.type === 'unchanged'"></i>
                <span>{{ diff.type }}</span>
              </span>
            </td>
            <td class="td-value">
              <pre *ngIf="diff.type !== 'added'" class="value-pre">{{ formatValue(diff.leftValue) }}</pre>
              <span *ngIf="diff.type === 'added'" class="value-empty">—</span>
            </td>
            <td class="td-value">
              <pre *ngIf="diff.type !== 'removed'" class="value-pre">{{ formatValue(diff.rightValue) }}</pre>
              <span *ngIf="diff.type === 'removed'" class="value-empty">—</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="differences().length === 0 && leftJson() && rightJson() && !error() && !isProcessing()" class="empty-state">
    <div class="empty-icon">
      <i class="fa-solid fa-circle-check"></i>
    </div>
    <h4 class="empty-title">No Differences Found</h4>
    <p class="empty-text">Both JSON files are identical</p>
  </div>

</div>
