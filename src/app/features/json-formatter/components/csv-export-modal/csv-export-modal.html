@if (isOpenSignal()) {
  <div class="modal-backdrop" (click)="onBackdropClick($event)">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fa-solid fa-file-csv"></i>
          CSV Export
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        
        <div class="form-group">
          <label for="filename">File Name</label>
          <input type="text" id="filename" class="form-control" [(ngModel)]="filename" placeholder="export" />
        </div>

        <div class="options-section">
          <h6 class="options-title">Export Options</h6>
          
          <div class="options-grid">
            
            <div class="form-group">
              <label for="delimiter">Delimiter</label>
              <select id="delimiter" class="form-control" [(ngModel)]="delimiter">
                <option value="comma">Comma (,)</option>
                <option value="semicolon">Semicolon (;)</option>
                <option value="tab">Tab</option>
                <option value="pipe">Pipe (|)</option>
              </select>
            </div>

            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="includeHeaders" />
                <span>Include Headers</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="flattenObjects" />
                <span>Flatten Nested Objects</span>
              </label>

              <label class="checkbox-label">
                <input type="checkbox" [(ngModel)]="flattenArrays" />
                <span>Flatten Nested Arrays</span>
              </label>
            </div>
          </div>
        </div>

        <div class="preview-section">
          <label class="preview-label">Preview</label>
          <textarea class="preview-textarea" [value]="csvPreview()" readonly spellcheck="false"></textarea>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">
          <i class="fa-solid fa-times"></i>
          Close
        </button>

        <button type="button" class="btn btn-outline-primary" (click)="copyToClipboard()" [class.copied]="isCopied()">
          <i class="fa-solid" [class.fa-copy]="!isCopied()" [class.fa-check]="isCopied()"></i>
          {{ isCopied() ? 'Copied!' : 'Copy to Clipboard' }}
        </button>

        <button type="button" class="btn btn-primary" (click)="downloadCsv()">
          <i class="fa-solid fa-download"></i>
          Save to Disk
        </button>
      </div>

    </div>
  </div>
}
